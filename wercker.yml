box: michilu/goapp
build:
    steps:
        - setup-go-workspace

        - install-packages:
            packages: git

        - script:
            name: clone theme
            code: |
                mkdir -p themes
                cd themes
                git clone https://github.com/rlclakeview/rlc-theme.git

        - arjen/hugo-build:
            version: "0.15"
deploy:
    box: google/cloud-sdk
    steps:
        - script:
            name: install jq
            code: wget -O /usr/local/bin/jq https://github.com/stedolan/jq/releases/download/jq-1.5rc1/jq-linux-x86_64-static && chmod a+x /usr/local/bin/jq
        - script:
            name: gcr.io authentication
            code: |
                gcloud auth activate-refresh-token $GCLOUD_ACCOUNT $GCLOUD_REFRESH_TOKEN
                gcloud docker --authorize-only
                export GCR_AUTH_TOKEN=$(cat $HOME/.dockercfg | jq --raw-output '.["https://gcr.io"].auth' | base64 --decode | cut -d ':' -f2)
        - internal/docker-push:
            username: _token
            password: $GCR_AUTH_TOKEN
            repository: gcr.io/rlc-lakeview/test
            registry: grc.io
